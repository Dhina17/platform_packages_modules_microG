//
// Copyright (C) 2023 Kenvyra
// Copyright (C) 2024 The LibreMobileOS Foundation
//
// SPDX-License-Identifier: Apache-2.0
//

package {
    default_applicable_licenses: ["Android-Apache-2.0"],
}

apex_key {
    name: "com.libremobileos.microg.key",
    public_key: "com.libremobileos.microg.avbpubkey",
    private_key: "com.libremobileos.microg.pem",
}

android_app_import {
    name: "GmsCoreMicrog",
    owner: "microg",
    apk: "GmsCore/play-services-core-mapbox-default-release.apk",
    certificate: ":microg.certificate",
    privileged: true,
    uses_libs: ["com.android.location.provider"],
    optional_uses_libs: [
        "org.apache.http.legacy",
        "androidx.window.extensions",
        "androidx.window.sidecar"
    ],
    required: [
        "microg.xml",
        "privapp-permissions-microg.xml",
        "whitelist-microg.xml",
    ],
    apex_available: [
        "//apex_available:platform",
        "com.libremobileos.microg",
    ],
}

android_app_import {
    name: "FakeStore",
    owner: "microg",
    apk: "GmsCore/vending-app-default-release-unsigned.apk",
    certificate: ":microg.certificate",
    privileged: true,
    apex_available: [
        "//apex_available:platform",
        "com.libremobileos.microg",
    ],
}

android_app_import {
    name: "GsfProxy",
    owner: "microg",
    apk: "GsfProxy/services-framework-proxy-release-unsigned.apk",
    certificate: ":microg.certificate",
    apex_available: [
        "//apex_available:platform",
        "com.libremobileos.microg",
    ],
}

apex {
    name: "com.libremobileos.microg",
    defaults: ["u-launched-apex-module"],
    manifest: "manifest.json",
    apps: ["GmsCoreMicrog", "FakeStore", "GsfProxy"],
    prebuilts: [
        "microg.xml",
        "privapp-permissions-microg.xml",
        "whitelist-microg.xml"
    ],
    key: "com.libremobileos.microg.key",
    certificate: ":microg.certificate",
    compressible: false,
    updatable: true,
}

apex {
    name: "com.libremobileos.microg-stub",
    defaults: ["u-launched-apex-module"],
    manifest: "manifest-stub.json",
    key: "com.libremobileos.microg.key",
    certificate: ":microg.certificate",
    compressible: false,
    updatable: true,
}
